<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
    <head>
        <meta charset="UTF-8" />
        <title>Board_Read</title>
        <script th:src="@{/js/jquery-3.6.0.js}"></script>
        <script>
            function deleteboard(boardnum) {
                let a = confirm('삭제하시겠습니까?');
                if (a) {
                    document.getElementById('boardnum').value = boardnum;
                    document.getElementById('deleteForm').submit();
                }
            }

            function modifyInfo(boardnum) {
                let a = confirm('구매하시겠습니까?');
                if (a) {
                    document.getElementById('boardnum1').value = boardnum;
                    document.getElementById('modifyInfoForm').submit();
                }
            }
            function chkreply() {
                let text = document.getElementById('replytext').value;
                if (text == '') {
                    alert('내용을 입력하세요');
                    return false;
                }
                return true;
            }
        </script>
    </head>
    <body>
        <h1>[ 판매 정보 ]</h1>
        <table>
            <tr>
                <th>작성자</th>
                <td th:text="${board.memberid}"></td>
            </tr>
            <tr>
                <th>작성일</th>
                <td th:text="${board.inputdate}"></td>
            </tr>
            <tr>
                <th>제목</th>
                <td th:text="${board.title}"></td>
            </tr>
            <tr>
                <th>내용</th>
                <td><pre th:text="${board.contents}"></pre></td>
            </tr>
        </table>

        <div th:if="${#authentication.name} == ${board.memberid}">
            <a th:href="|javascript:deleteboard(${board.boardnum})|">삭제</a>
        </div>
        <div th:if="${#authentication.name} != ${board.memberid}">
            <a th:href="|javascript:modifyInfo(${board.boardnum})|">구매하기</a>
        </div>
        <!-- 글삭제 폼 -->
        <form th:action="@{/board/deleteboard}" method="post" id="deleteForm">
            <input type="hidden" name="boardnum" value="0" id="boardnum" />
        </form>
        <form th:action="@{/board/modifyInfo}" method="post" id="modifyInfoForm">
            <input type="hidden" name="boardnum" value="0" id="boardnum1" />
        </form>

        <!-- 리플작성 폼 -->
        <!-- 작성한 글 내용, 글번호를 서버로 전송 -->
        <form th:action="@{/board/insertReply}" method="post" onsubmit="return chkreply()">
            리플 내용 <input type="hidden" name="boardnum" id="boardnum" th:value="${board.boardnum}" />
            <input type="text" name="replytext" id="replytext" />
            <input type="submit" value="저장" />
        </form>

        <!-- 리플 목록 -->
        <table>
            <tr th:each="reply:${replyList}">
                <th:block th:if="${reply.boardnum == board.boardnum}">
                    <td th:text="${reply.memberid}"></td>
                    <td th:text="${reply.replytext}"></td>
                    <td th:text="${reply.inputdate}"></td>
                </th:block>
            </tr>
        </table>
    </body>
</html>
